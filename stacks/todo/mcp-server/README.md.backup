# Vikunja MCP Server

A Model Context Protocol (MCP) server that provides AI integration capabilities for Vikunja todo management. This server enables AI assistants to interact with your Vikunja instance through a standardized protocol.

## Features

### Core Capabilities
- **Task Management**: Create, read, update, delete tasks with full CRUD operations
- **Project Management**: Manage Vikunja projects and organize tasks
- **Search Functionality**: Find tasks by title, description, or other criteria  
- **Smart Task Creation**: Natural language processing for task creation
- **Real-time Integration**: Direct API integration with your Vikunja instance

### MCP Tools Available
1. **get_tasks** - Retrieve tasks with optional project filtering
2. **create_task** - Create new tasks with rich metadata
3. **update_task** - Modify existing tasks (title, description, status, priority)
4. **delete_task** - Remove tasks from Vikunja
5. **get_projects** - List all available projects
6. **create_project** - Create new projects
7. **search_tasks** - Search through tasks by keywords
8. **smart_create_task** - AI-powered task creation from natural language

### MCP Resources
- **vikunja://info** - Instance information and capabilities
- **vikunja://projects** - All projects data

### MCP Prompts
- **task_creation_assistant** - Helps structure tasks with proper priorities and descriptions

## Installation & Setup

### Prerequisites
- Node.js 20+
- Access to a Vikunja instance
- Vikunja API credentials or username/password

### Quick Start

1. **Install dependencies**:
```bash
npm install
```

2. **Configure environment**:
```bash
cp .env.example .env
# Edit .env with your Vikunja credentials
```

3. **Build and run**:
```bash
npm run build
npm start
```

### Development Mode
```bash
npm run dev
```

## Configuration

### Environment Variables

| Variable | Description | Required | Example |
|----------|-------------|----------|---------|
| `VIKUNJA_BASE_URL` | Your Vikunja instance URL | Yes | `http://vikunja.desktop.chrisd.uk` |
| `VIKUNJA_USERNAME` | Username for authentication | No* | `your-username` |
| `VIKUNJA_PASSWORD` | Password for authentication | No* | `your-password` |
| `VIKUNJA_API_TOKEN` | API token (alternative to user/pass) | No* | `your-api-token` |
| `PORT` | MCP server port | No | `8603` |
| `TRANSPORT_MODE` | `http` or `stdio` | No | `http` |
| `LOG_LEVEL` | Logging verbosity | No | `info` |

*Either username/password OR API token is required.

### Authentication Methods

**Option 1: Username/Password**
```env
VIKUNJA_USERNAME=your-username
VIKUNJA_PASSWORD=your-password
```

**Option 2: API Token** (Recommended for production)
```env
VIKUNJA_API_TOKEN=your-api-token
```

## Usage Examples

### Creating a Task
```typescript
// Using the create_task tool
{
  "title": "Implement user authentication",
  "description": "Add JWT-based authentication to the API",
  "project_id": 1,
  "priority": 3,
  "due_date": "2024-02-15T10:00:00Z"
}
```

### Smart Task Creation
```typescript
// Using smart_create_task with natural language
{
  "input": "High priority: Fix the urgent login bug due tomorrow",
  "project_id": 1
}
// Automatically parses priority, due date, and creates structured task
```

### Searching Tasks
```typescript
// Using search_tasks
{
  "query": "authentication",
  "project_id": 1  // optional
}
```

## API Integration

### HTTP Transport (Default)
The server runs as an HTTP service with SSE transport:

```bash
# Health check
curl http://localhost:8603/health

# MCP endpoint
# Connect your MCP client to: http://localhost:8603/message
```

### STDIO Transport
For local integrations (Claude Desktop, etc.):

```bash
TRANSPORT_MODE=stdio npm start
```

## Docker Deployment

### Build Image
```bash
docker build -t vikunja-mcp-server .
```

### Run Container
```bash
docker run -p 8603:8603 \
  -e VIKUNJA_BASE_URL=http://vikunja.desktop.chrisd.uk \
  -e VIKUNJA_API_TOKEN=your-token \
  vikunja-mcp-server
```

### Quick Test Command âœ… VERIFIED WORKING
```bash
# Build and run for testing
docker build -t vikunja-mcp-server:test . && \
docker run -d \
  --name vikunja-mcp-test \
  -p 8603:8603 \
  -e VIKUNJA_BASE_URL=http://vikunja.desktop.chrisd.uk \
  -e VIKUNJA_USERNAME=your-username \
  -e VIKUNJA_PASSWORD=your-password \
  -e PORT=8603 \
  vikunja-mcp-server:test

# Test endpoints
curl http://localhost:8603/health
curl http://localhost:8603/api/info
curl -X POST http://localhost:8603/message \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc": "2.0", "id": 1, "method": "tools/list"}'

# Cleanup
docker stop vikunja-mcp-test && docker rm vikunja-mcp-test
```

### Docker Compose Integration
The server is designed to work with the main todo stack:

```yaml
# Already included in docker-compose.yml
mcp-server:
  build: ./mcp-server
  ports:
    - "8603:8603"
  environment:
    - VIKUNJA_BASE_URL=http://vikunja.desktop.chrisd.uk
    - VIKUNJA_API_TOKEN=${VIKUNJA_API_TOKEN}
    - PORT=8603
```

## Error Handling

The server includes comprehensive error handling:

- **Authentication Errors**: Automatic retry with proper error messages
- **API Rate Limiting**: Respects Vikunja API limits
- **Network Issues**: Timeout handling and reconnection logic
- **Data Validation**: Zod schema validation for all inputs

## Logging

Structured JSON logging with configurable levels:

```bash
LOG_LEVEL=debug npm start  # Detailed debugging
LOG_LEVEL=info npm start   # Standard logging
LOG_LEVEL=error npm start  # Errors only
```

## Security

### Best Practices Implemented
- Environment variable configuration for secrets
- Input validation using Zod schemas
- CORS configuration for web security
- Request timeout protection
- Secure error messages (no sensitive data leakage)

### Recommendations
- Use API tokens instead of username/password in production
- Run behind reverse proxy with HTTPS
- Implement additional rate limiting if needed
- Monitor logs for suspicious activity

## Monitoring & Health Checks

### Health Endpoint
```bash
curl http://localhost:8603/health
```

Returns:
```json
{
  "status": "healthy",
  "timestamp": "2024-01-15T10:30:00Z",
  "authenticated": true
}
```

### Logging Integration
Compatible with standard log aggregation tools:
- Docker logs
- Kubernetes logging
- ELK stack
- Fluentd

## Troubleshooting

### Common Issues

**Authentication Failed**
```bash
# Check credentials
curl http://vikunja.desktop.chrisd.uk/api/v1/info
```

**Connection Refused**
- Verify Vikunja URL is accessible
- Check network connectivity
- Ensure Vikunja API is enabled

**CORS Issues**
- Update `CORS_ORIGINS` environment variable
- Verify frontend domain is included

### Debug Mode
```bash
LOG_LEVEL=debug npm run dev
```

## Integration with Claude Desktop

Add to your Claude Desktop MCP configuration:

```json
{
  "mcpServers": {
    "vikunja": {
      "command": "node",
      "args": ["/path/to/vikunja-mcp-server/dist/server.js"],
      "env": {
        "VIKUNJA_BASE_URL": "http://vikunja.desktop.chrisd.uk",
        "VIKUNJA_API_TOKEN": "your-token",
        "TRANSPORT_MODE": "stdio"
      }
    }
  }
}
```

## Contributing

1. Fork the repository
2. Create feature branch: `git checkout -b feature-name`
3. Make changes and test thoroughly
4. Submit pull request with detailed description

### Development Setup
```bash
git clone <repo-url>
cd mcp-server
npm install
cp .env.example .env
# Configure environment
npm run dev
```

## License

MIT License - see LICENSE file for details.